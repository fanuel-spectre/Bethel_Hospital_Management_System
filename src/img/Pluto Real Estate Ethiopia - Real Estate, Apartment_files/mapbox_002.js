define(["jquery","appconfig","wsbcore/helper","js!//api.mapbox.com/mapbox.js/v2.4.0/mapbox.js","css!//api.mapbox.com/mapbox.js/v2.4.0/mapbox.css"],function(e,a){function o(a,o){e.getJSON(a,function(e){e&&o(JSON.stringify(e))})}function n(a,n,r,l,i,d){a&&a._leaflet&&(e(a).find(".leaflet-map-pane").remove(),e(a).find(".leaflet-control-container").remove(),a._leaflet=!1),(""===n.trim()||n.trim()===p.address)&&(n=p.address,r.lat=p.defaultCoordinates[1],r.lng=p.defaultCoordinates[0]);var c=r.zoom||p.zoom;if(r.lng&&r.lat)t(a,n,[r.lng,r.lat],c,l,i);else{var m=p.apiKey||l,f=p.apiurl||d,u=f.replace("{0}",encodeURIComponent(s(n)))+m;o(u,function(e){geoData=JSON.parse(e),geoData&&geoData.features[0]&&t(a,n,[geoData.features[0].center[0],geoData.features[0].center[1]],c,l,i)})}}function t(a,o,n,t,i,d){if(!a)return void l();o&&n||(o=p.address,n=p.defaultCoordinates);var s=null,c=n[0],m=n[1];if(L.mapbox.accessToken=p.apiKey||i,a){a._leaflet&&(e(a).find(".leaflet-map-pane").remove(),e(a).find(".leaflet-control-container").remove(),a._leaflet=!1),s=L.mapbox.map(a,"mapbox.streets",{zoomControl:!1,legendControl:{position:"topleft"}}).setView([m,c],t);var f=new L.Marker(new L.LatLng(m,c));s.addLayer(f),s.invalidateSize(),s.legendControl.addLegend(r(o)),L.control.zoom({position:"bottomleft"}).addTo(s),s.scrollWheelZoom.disable(),d?(e(".map-legends").addClass("mapbox-legend-padding"),e(".map-legend").addClass("mapbox-legend-padding"),e(".leaflet-control-zoom").addClass("mapbox-leaflet-zoom-control-bottom")):(s.dragging.disable(),s.touchZoom.disable(),s.doubleClickZoom.disable(),e(".map-legends").addClass("mapbox-legend-padding mapbox-avoid-clicks"),e(".map-legend").addClass("mapbox-legend-padding mapbox-avoid-clicks"),e(".leaflet-control-zoom").addClass("mapbox-leaflet-zoom-control-bottom mapbox-avoid-clicks"),e(".leaflet-control-attribution").addClass("mapbox-avoid-clicks"))}}function r(a){var o=e("<div></div>",{text:a,css:{margin:"0px",padding:"5px",background:"white",color:"black",border:"1px solid black","line-height":"initial"}});return o.get(0).outerHTML}function l(){require(["/i18n/resources/client","wsbcore/growl"],function(a){e("<div></div>").sfGrowl({title:a.resources.Client__Designer__Yikes_hit_a_snag,content:a.resources.Server__There_has_been_an_unexpected_error,icon:"error"})})}function d(e,a){var n="";e&&""!=e.trim()?o(p.apiurl.replace("{0}",encodeURIComponent(s(e)))+p.apiKey,function(e){var o=JSON.parse(e);if(o&&o.features[0]){var t=o.features[0].place_name;a(t)}else a(n)}):a(n)}function s(e){if(a.mapboxApiBlockedChars)for(i=0;i<a.mapboxApiBlockedChars.length;i++)e=e.replace(new RegExp(a.mapboxApiBlockedChars[i],"g")," ");return e}var p={language:"en_US",apiKey:a.mapboxApiKey,address:"Scottsdale, AZ",zoom:14,defaultCoordinates:[-111.8992,33.5091],apiurl:a.mapboxApiBaseUrl,permanentMapboxApiUrl:a.mapboxApiPermanentBaseUrl};return{generateMap:n,getAddressAutoComplete:function(a,n,t){if(a){a=s(a);var r=e("#savedAddress").val();t&&r&&r!==a?o(p.permanentMapboxApiUrl.replace("{0}",encodeURIComponent(a))+p.apiKey,n):o(p.apiurl.replace("{0}",encodeURIComponent(a))+p.apiKey,n)}},getCustomFormAddressAutoComplete:function(e,a,n,t){var r=p.apiurl||n;o(r.replace("{0}",encodeURIComponent(s(e)))+a,t)},getClosestStreetAddress:function(e,a){d(e,a)}}});
//# sourceMappingURL=mapbox.js.map