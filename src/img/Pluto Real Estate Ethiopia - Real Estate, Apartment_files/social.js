define(["designer/util/util.instances","designer/util/util.model","jquery","wsbcore/helper","designer/util/facebookSDKHelper"],function(e,t,a,s,i){function o(e,a){this.$element=e,this.model=new t(a),this.mode=this.model.get("mode"),this.subscriptions=[],this.init()}var r="wsb-social-share";o.prototype={init:function(){var e=this;if("designer"===this.mode&&this.model.isKO){var t=this.model.get();if(t.mutatorViewModel){var a=function(){e.refresh()};for(var s in t.mutatorViewModel)t.ko.isObservable(t.mutatorViewModel[s])&&this.subscriptions.push(t.mutatorViewModel[s].subscribe(a))}}this.refresh(!0)},ready:function(e){var t=this,i=function(){"designer"===t.mode&&t.model.isKO&&require(["/i18n/resources/client","wsbcore/growl"],function(e){a("<div></div>").sfGrowl({title:e.resources.Client__Designer__Yikes_hit_a_snag,content:e.resources.Server__There_has_been_an_unexpected_error,icon:"error"})}),t.destroy()};s.require(["js!//s7.addthis.com/js/300/addthis_widget.js#async=1"],function(){function a(){1>--o&&(clearInterval(s),i())}var s,o=20;s=setInterval(function(){window&&window.addthis&&window.addthis.init?(window.addthis.init(),window.addthis.toolbox(t.$element[0]),"designer"===t.mode&&t.updateOverlay(e)):a()},100)},i)},refresh:function(e){var t=this;this.$element.attr("class",r).children().remove();var s="",o=r+"-button",l=this.model.get("ShareTheme");if("mobile"===this.mode)switch(l){case"Small Buttons":case"Small Buttons - Vertical":case"Buttons - Vertical":l="Buttons";break;case"Counter":case"Counter - Vertical":case"Horizontal Counter":case"Bubble Counter - Vertical":case"Vertical Counter":l="Bubble Counter"}switch(Boolean(l.match(/- Vertical$/i))&&(o+="-vert"),l){case"Buttons":case"Buttons - Vertical":this.$element.addClass("addthis_toolbox addthis_default_style addthis_32x32_style"),this.model.get("ShareFacebook")&&(s+='<a class="addthis_button_facebook '+o+'"></a>'),this.model.get("ShareTwitter")&&(s+='<a class="addthis_button_twitter '+o+'"></a>'),this.model.get("SharePinterest")&&(s+='<a class="addthis_button_pinterest_share '+o+'"></a>'),this.model.get("ShareEmail")&&(s+='<a class="addthis_button_email '+o+'"></a>'),this.model.get("ShareMore")&&(s+='<a class="addthis_button_expanded '+o+'"></a>');break;case"Small Buttons":case"Small Buttons - Vertical":this.$element.addClass("addthis_toolbox addthis_default_style"),this.model.get("ShareFacebook")&&(s+='<a class="addthis_button_facebook '+o+'"></a>'),this.model.get("ShareTwitter")&&(s+='<a class="addthis_button_twitter '+o+'"></a>'),this.model.get("SharePinterest")&&(s+='<a class="addthis_button_pinterest_share '+o+'"></a>'),this.model.get("ShareEmail")&&(s+='<a class="addthis_button_email '+o+'"></a>'),this.model.get("ShareMore")&&(s+='<a class="addthis_button_expanded '+o+'"></a>');break;case"Toolbar":s+='<a class="addthis_button" href="//www.addthis.com/bookmark.php?v=300&amp;pubid=xa-5107daf277cd4d0c"><img src="//s7.addthis.com/static/btn/v2/lg-share-en.gif" width="125" height="16" alt="Bookmark and Share" style="border:0"/></a>';break;default:case"Counter":case"Counter - Vertical":case"Horizontal Counter":this.$element.addClass("addthis_toolbox addthis_default_style"),this.model.get("ShareFacebook")&&(s+='<a class="addthis_button_facebook_like '+o+'" fb:like:layout="button_count"></a>'),this.model.get("ShareTwitter")&&(s+='<a class="addthis_button_tweet '+o+'"></a>');break;case"Bubble Counter":case"Bubble Counter - Vertical":case"Vertical Counter":this.$element.addClass("addthis_toolbox addthis_default_style addthis_counter_style"),this.model.get("ShareFacebook")&&(s+='<a class="addthis_button_facebook_like '+o+'" fb:like:layout="box_count"></a>'),this.model.get("ShareTwitter")&&(s+='<a class="addthis_button_tweet '+o+'" tw:count="vertical"></a>')}this.$element.html(s),"object"!=typeof window.addthis?a(document).ready(function(){t.ready(e)}):t.ready(e);var d=this.model.get("FacebookUrl"),n={"class":"fb-page","data-href":d};i.setApiGraphVersion(this.model.get("FbGraphApiVersion")),i.likeBoxGenerator(this.$element,n)},updateOverlay:function(e){if(!e&&this.model.isKO){var t=this;clearInterval(this.overlayTimer),this.overlayTimerCount=0,this.overlayTimer=setInterval(function(){if(t.overlayTimerCount>=20)clearInterval(t.overlayTimer),t.overlayTimerCount=0;else{t.overlayTimerCount++,t.$element.removeClass("resized");var e=t.model.get("getLast",!0);if(!(e instanceof Function))return;if(!t.model.model||!t.model.model.undoer)return;var a=t.model.model.undoer,s=!a.getCurrentState().isCollect;if(s){var i=t.model.get("getLast",!0)("Width"),o=t.model.get("getLast",!0)("Height");if(parseFloat((i&&i.NewValue||t.model.get("Width")).replace("px",""))<t.$element.outerWidth(!0)){a.disable();var r=t.$element.outerWidth(!0)+"px";i&&(i.NewValue=r),t.model.set("Width",r),a.enable()}if(parseFloat((o&&o.NewValue||t.model.get("Height")).replace("px",""))<t.$element.outerHeight(!0)){a.disable();var l=t.$element.outerHeight(!0)+"px";o&&(o.NewValue=l),t.model.set("Height",l),a.enable()}}else parseFloat(t.model.get("Width").replace("px",""))<t.$element.outerWidth(!0)&&t.model.set("Width",t.$element.outerWidth(!0)+"px"),parseFloat(t.model.get("Height").replace("px",""))<t.$element.outerHeight(!0)&&t.model.set("Height",t.$element.outerHeight(!0)+"px");t.$element.addClass("resized")}},100)}},destroy:function(){for(var e in this.subscriptions)this.subscriptions[e].dispose();l.destroy(this.$element),this.$element.remove()}};var l=new e(r,o);return{render:function(e,t){var a=l.get(e);return a?a.refresh():a=l.create(e,t),a},destroy:function(e){var t=l.get(e);return t?(l.destroy(e),!0):!1}}});
//# sourceMappingURL=social.share.js.map